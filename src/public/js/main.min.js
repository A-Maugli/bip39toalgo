const{PDFDocument,StandardFonts,rgb}=PDFLib,DefaultParams={method:"slip10-ed25519",path:"m/44'/283'/0'/0/0",mnemonic:"",passphrase:"",client:"coinomi",mnemonicLabel:"Enter BIP39 Mnemonic (12-24 words)..."},clients=["atomic","coinomi","exodus","ledger","trust","custom","search"],Status={done:31401,wip:31402,err:31403},bk={xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1400},vw=()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),vh=()=>Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),D=()=>[...Object.entries(bk)].reverse().reduce((e,[a,t],o)=>vw()>=t&&"na"===e?a:e,"na");var intervalId,S={d:void 0,algo:void 0,statusTimeoutId:void 0};function onDocumentReadyHandler(){clear("all"),S.d=D(),updateStatus("Ready!"),tabSwitcher()}function tabSwitcher(){switch(window.location.hash){case"#":case"":case void 0:case"#mnemoTab":showMnemonicTab();break;case"#addressTab":showAddressTab();break;case"#infoTab":showInfoTab()}}const range=(e,t=0)=>Array.from(new Uint8Array(e).map((e,a)=>a+t));function getParams(){return params={mnemonic:$("#mnemoTxt").val(),method:$("#method option:checked")[0].text,path:getPath(),passphrase:$("#mnemoPass").val(),client:$("#clients option:checked").val(),mnemonicLabel:$("#mnemoLbl").html()},params}function getPath(){return path="m",ip=$(".deriv-path"),ip.map(e=>{path+="/"+(parseInt(ip[e].value)?parseInt(ip[e].value):0),e<3&&(path+="'")}),path}function clear(e){$("#bip39seed").val(""),$("#algoAddress").val(""),$("#algoKey").val(""),$("#qrcode").html(""),$("#qrcode2").html(""),$(".algo-secret").hide(),$("#algoMnemonic").html(""),S.algo=void 0,"mnemonic"!=e&&"all"!=e||$("#mnemoTxt").val(""),"lookup"!=e&&"all"!=e||($("#lookupWhat").val(""),$("#lookupWhat").removeClass("is-valid"),$("#lookupWhat").removeClass("is-invalid"),$("#lookupFeedback").html("")),"search"!=e&&"all"!=e||($("#searchAddress").val(""),$("#searchAddress").removeClass("is-valid"),$("#searchAddress").removeClass("is-invalid"),$("#searchFeedback").html("")),"all"==e&&changeWalletClient(DefaultParams.client)}function showMnemonicTab(){$("#mainTitle").html("BIP39 to Algorand Mnemonic"),$(".mnemo-tab").show(),$(".address-tab").hide(),$(".info-tab").hide(),$(".tools-tab").show(),$("#mnemoTab").addClass("active"),$("#addressTab").removeClass("active"),$("#infoTab").removeClass("active"),$("#searchSection").hide(),clear(),changeWalletClient(getParams().client)}function showAddressTab(){$("#mainTitle").html("Find Me a Cool Address"),$(".mnemo-tab").hide(),$(".address-tab").show(),$(".info-tab").hide(),$(".tools-tab").show(),$("#mnemoTab").removeClass("active"),$("#addressTab").addClass("active"),$("#infoTab").removeClass("active"),clear("lookup")}function showInfoTab(){$("#mainTitle").html(""),$(".mnemo-tab").hide(),$(".address-tab").hide(),$(".info-tab").show(),$(".tools-tab").hide(),$("#mnemoTab").removeClass("active"),$("#addressTab").removeClass("active"),$("#infoTab").addClass("active")}function updateStatus(e,a=Status.done){if(S.statusTimeoutId&&clearTimeout(S.statusTimeoutId),clearStatus(),a===Status.done)S.statusTimeoutId=setTimeout(()=>clearStatus(),3e3),$("#status").addClass("text-white bg-success");else if(a===Status.wip)$("#status").addClass("text-dark bg-warning");else{if(a!==Status.err)return;S.statusTimeoutId=setTimeout(()=>clearStatus(),3e3),$("#status").addClass("text-white bg-danger")}$("#status").addClass("shadow-sm px-3 py-1"),$("#status > small").html(e)}function clearStatus(){c=["shadow-sm","px-3","py-1","text-white","text-dark","bg-success","bg-warning","bg-danger"],$("#status").removeClass(c),$("#status > small").html(""),S.statusTimeoutId=void 0}function generateMnemonic(){w=parseInt($("#mnemoRandSize option:selected").val()),s=(11*w-11*w%32)/8,bip39toalgo.randomWords(s).then(e=>{$("#mnemoTxt").val(e),checkMnemonic()})}function clearMnemonic(){clear("all"),$("#mnemoTxt").removeClass("is-valid"),$("#mnemoTxt").removeClass("is-invalid")}function checkMnemonic(){sel=getParams(),parsedMnemonic=bip39toalgo.parseMnemonic(sel.mnemonic),sel.mnemonic&&""!=sel.mnemonic?parsedMnemonic.valid?($("#mnemoTxt").addClass("is-valid"),$("#mnemoTxt").removeClass("is-invalid")):($("#mnemoTxt").addClass("is-invalid"),$("#mnemoTxt").removeClass("is-valid")):($("#mnemoTxt").removeClass("is-valid"),$("#mnemoTxt").removeClass("is-invalid"))}function printPath(a,t=-1){ip=$(".deriv-path"),ip.map(e=>{ip[e].value=a?parseInt(a.split("/")[e+1]):"",ip[e].disabled=e<t})}function changeMethod(a){mt=$("#method option"),mt.map(e=>{mt[e].text==a&&(mt[e].selected=!0)})}function changeWalletClient(e){if(idx=clients.indexOf(e),-1===idx)throw new Error(`Client "${e}" not supported!`);$("#clients")[0].selectedIndex=idx,"custom"!=e&&"search"!=e?(wallet=bip39toalgo.wallets[e],$("#searchSection").hide(),$("#method").prop("disabled",!0),printPath(wallet.path,"atomic"==e?999:2),changeMethod(wallet.method)):"custom"==e?(printPath(DefaultParams.path),$("#method").prop("disabled",!1),$("#searchSection").hide()):"search"==e&&(printPath(DefaultParams.path,999),$("#method").prop("disabled",!0),$("#searchSection").show(),$("#startBtn").prop("disabled",!0)),"search"!=e&&$("#startBtn").prop("disabled",!1)}function handleChangeWalletClient(e){client=e.target.selectedOptions[0].value,changeWalletClient(client)}function startMnemonicDerivation(){sel=getParams(),parsedMnemonic=bip39toalgo.parseMnemonic(sel.mnemonic),parsedMnemonic.valid?($("#mnemoTxt").removeClass("is-invalid"),$("#mnemoTxt").addClass("is-valid"),bip39toalgo.deriveMnemonic(sel.mnemonic,sel.method,sel.path,sel.passphrase).then(e=>{$("#bip39seed").val(e.bip39seed),$("#algoAddress").val(e.algo.address),$("#algoKey").val(e.algo.key),$("#mnemoTxt").val(parsedMnemonic.mnemonic),printWords(e.algo.words),printQR(e.algo.words),S.algo=e.algo,updateStatus("done!")})):($("#mnemoTxt").removeClass("is-valid"),$("#mnemoTxt").addClass("is-invalid"))}function printWords(e){$(".algo-secret").show(),o=$("#algoMnemonic"),o.html(""),s="xs"===D()||"sm"===D()?2:5,cols=range(s).map(e=>{let a=document.createElement("div");return a.classList.add("col"),a}),idx=0,e.map((e,a)=>{let t=document.createElement("div"),o=document.createElement("pre"),i=document.createElement("span");t.classList.add("row"),o.innerHTML=`${(a+1).toString().padStart(2," ")}. `,i.innerHTML=e,i.style.color="#d63384",o.appendChild(i),t.appendChild(o),cols[idx].appendChild(t),2==s&&12==a&&idx++,5==s&&a%5==4&&idx++}),cols.forEach(e=>o.append(e))}function rePrintWords(){D()!==S.d&&(S.d=D(),S.algo&&printWords(S.algo.words))}function printQR(e){algoMnemonic={version:"1.0",mnemonic:e.join(" ")},$("#qrcode").html(""),$("#qrcode").qrcode({text:JSON.stringify(algoMnemonic),width:296,height:296})}function printAddressQR(e){$("#qrcode2").html(""),$("#qrcode2").qrcode({text:e,width:296,height:296})}function copyTargetValue(e){!e.target.value&&""===e.target.value||(e.target.select(),e.target.setSelectionRange(0,99999),document.execCommand("copy"),updateStatus("Copied"))}function findMyCoolAddress(a,t,o,i){bip39toalgo.randomAlgoAddress().then(e=>{t=!e.address.startsWith(a.toUpperCase()),e&&$("#algoAddress").val(e.address),t||(clearInterval(o),tock=Date.now(),$("#lookupFeedback").html("<br>Address found in "+(tock-i)/1e3+" seconds"),$("#lookupBtn").prop("disabled",!1),$("#lookupBtnSpinner").hide(),$("#algoKey").val(e.key),bip39toalgo.algoWords(e.key).then(e=>{printWords(e.words),printQR(e.words),S.algo=e,updateStatus("done!")}))})}function startMyCoolAddressLookup(e,a){return clear(),tick=Date.now(),updateStatus("Working...",Status.wip),id=setInterval(()=>{findMyCoolAddress(e,a,id,tick)},10),id}function handleMyCoolAddressLookup(){where="prefix",what=$("#lookupWhat").val(),check=checkBase32Input("#lookupWhat","#lookupInvalid",6),0<check&&($("#lookupFeedback").html(""),$("#lookupBtn").prop("disabled",!0),$("#lookupBtnSpinner").show(),intervalId=startMyCoolAddressLookup(what,!0))}function killMyCoolAddressLookup(){clearInterval(intervalId),updateStatus("Canceled",Status.err),$("#lookupBtn").prop("disabled",!1),$("#lookupBtnSpinner").hide()}function derivationSearch(a,e,t,o){return 0==t.length?bip39toalgo.deriveBip39Seed(e,"bip39-seed","m/0'/0'/0'/0/0").then(e=>($("#bip39seed").val(e.bip39seed),$("#algoAddress").val("Not found"),$("#algoKey").val("Not found"),updateStatus("Not found!",Status.err),!0)).then(e=>endDerivationSearch(e,o)):(method=t[0][0],path=t[0][1],t.shift(),ip.map(e=>{ip[e].value=parseInt(path.split("/")[e+1])}),mt=$("#method option"),mt.map(e=>{mt[e].text==method&&(mt[e].selected=!0)}),bip39toalgo.deriveBip39Seed(e,method,path).then(e=>($("#bip39seed").val(e.bip39seed),$("#algoAddress").val(e.algo.address),$("#algoKey").val(e.algo.key),ip=$(".deriv-path"),a==e.algo.address&&(printWords(e.algo.words),printQR(e.algo.words),S.algo=e.algo,updateStatus("done!"),!0))).then(e=>endDerivationSearch(e,o)))}function startDerivationSearch(a){clear(),tick=Date.now(),sel=getParams(),updateStatus("Working...",Status.wip),bip39toalgo.bip39seed(sel.mnemonic,sel.passphrase).then(e=>{methods=["slip10-ed25519","slip10-secp256k1","kholaw-ed25519"],paths=[],field=[["bip39-seed","m/0'/0'/0'/0/0"]],range(10).map(a=>range(10).map(e=>paths.push("m/44'/283'/"+a+"'/0/"+e))),methods.forEach(a=>paths.forEach(e=>field.push([a,e]))),i=0,id=setInterval(()=>{derivationSearch(a,e,field,id)},10),intervalId=id})}function handleDerivationSearch(){check=checkBase32Input("#searchAddress","#searchInvalid",58,!1),0<check&&(sel=getParams(),parsedMnemonic=bip39toalgo.parseMnemonic(sel.mnemonic),parsedMnemonic.valid?($("#searchBtn").prop("disabled",!0),$("#searchBtnSpinner").show(),address=$("#searchAddress").val(),startDerivationSearch(address)):($("#mnemoTxt").removeClass("is-valid"),$("#mnemoTxt").addClass("is-invalid")))}function endDerivationSearch(e,a){e&&(clearInterval(a),$("#searchBtn").prop("disabled",!1),$("#searchBtnSpinner").hide())}function killDerivationSearch(){updateStatus("Canceled",Status.err),endDerivationSearch(!0,intervalId)}function mnemonicKeyboardEventHandler(e){keyCode=e.keyCode||e.which,m=e.target.value.trim().toLowerCase().normalize("NFKD").split(" "),w=m.slice(-1)[0],"keyup"==e.type&&9!=keyCode?(bw=bip39toalgo.findBip39Word(w),bw?($("#mnemoLbl").html(bw),$("#mnemoTxt").removeClass("is-invalid")):2<w.length&&(w=m.slice(-1)[0],$("#mnemoLbl").html('invalid word "'+w+'"'),$("#mnemoTxt").addClass("is-invalid"),$("#mnemoTxt").removeClass("is-valid"))):9==keyCode&&(e.preventDefault(),w=m.slice(-1)[0],bw=bip39toalgo.findBip39Word(w),bw&&(e.target.value=(m.slice(0,-1).join(" ")+" "+bw).trim()))}function mnemonicFocusoutHangler(e){$("#mnemoLbl").html(DefaultParams.mnemonicLabel),checkMnemonic()}function checkBase32Input(e,a,t,o=!0){return b32="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",inputField=$(e),invalidFeedback=$(a),m=inputField.val().trim().toUpperCase().normalize("NFKD").split(""),isValid=!0,o||m.length==t?0==m.length||m.length>t?(inputField.removeClass("is-valid"),inputField.addClass("is-invalid"),invalidFeedback.html("Invalid search: please input 1 to "+t+" characters (A-Z and 2-7)"),-1):58!=t||58!=m.length||(b32endings=b32.split("").reduce((e,a,t)=>(t%4==0&&e.push(a),e),[]),validEnding=0<=b32endings.indexOf(m.splice(-1)[0]),validEnding)?(m.map((e,a,t)=>{isValid&=0<=b32.search(e)}),isValid?(inputField.removeClass("is-invalid"),inputField.addClass("is-valid"),1):(inputField.removeClass("is-valid"),inputField.addClass("is-invalid"),invalidFeedback.html("Invalid search: valid characters are A-Z and 2-7"),-1)):(inputField.removeClass("is-valid"),inputField.addClass("is-invalid"),invalidFeedback.html("Invalid Algorand address, last character should be A,E,I,M,Q,U,Y or 4"),-1):(inputField.removeClass("is-valid"),inputField.addClass("is-invalid"),invalidFeedback.html("Invalid search: please input "+t+" characters (A-Z and 2-7)"),-1)}function prettifyWords(e){return prettyWords=e.map((e,a)=>(e=((a+1).toString().padStart(2)+". "+e).padEnd(15),20<=a&&(e+="\n"),e)).map((e,a,t)=>t[a%5*5+Math.floor(a/5)]),prettyWords.join("")}async function createPdf(){const e=await PDFDocument.create();await e.embedFont(StandardFonts.TimesRoman);var a=await e.embedFont(StandardFonts.Courier),t=await e.embedFont(StandardFonts.Helvetica);const o=e.addPage();printAddressQR(S.algo.address);const i=$("#qrcode2 > canvas")[0];var n=i?i.toDataURL():void 0;const s=await e.embedPng(n);$("#qrcode2").html("");const d=$("#qrcode > canvas")[0];var l=d?d.toDataURL():void 0;const r=await e.embedPng(l);n=s.scale(.5),l=r.scale(.7);height=o.getHeight()-44,txt=`ALGORAND OFFLINE PAPER WALLET
Use this wallet as a cold storage option. Import the wallet address as a view-only account in
the official Algorand app. Your secret will be completely offline. Store in a secure place!`,o.drawText(txt,{x:50,y:height,size:11,font:t,color:rgb(0,0,0)}),txt="Wallet Address\n",height-=88,o.drawText(txt,{x:50,y:height,size:11,font:t,color:rgb(0,0,0)}),txt=`${S.algo.address}\n`,height-=22,o.drawText(txt,{x:50,y:height,size:11,font:a,color:rgb(214/255,.2,132/255)}),height-=22+n.height,o.drawImage(s,{x:o.getWidth()/2-n.width/2,y:height,width:n.width,height:n.height}),txt="Wallet Secret\n",height-=44,o.drawText(txt,{x:50,y:height,size:11,font:t,color:rgb(0,0,0)}),txt=prettifyWords(S.algo.words),height-=22,o.drawText(txt,{x:50,y:height,size:11,font:a,color:rgb(214/255,.2,132/255)}),height-=121+l.height,o.drawImage(r,{x:o.getWidth()/2-l.width/2,y:height,width:l.width,height:l.height});l=await e.save();download(l,`${S.algo.address}.pdf`,"application/pdf")}$(document).ready(onDocumentReadyHandler),$(window).on("hashchange",tabSwitcher),$(window).resize(rePrintWords),$("#mnemoClear").on("click",clearMnemonic),$("#mnemoRand").on("click",generateMnemonic),$("#clearResultsBtn").on("click",clear),$("#bip39seed, #algoAddress, #algoKey").on("click",copyTargetValue),$("#startBtn").on("click",startMnemonicDerivation),$("#clients").on("change",handleChangeWalletClient),$("#searchBtn").on("click",handleDerivationSearch),$("#searchKill").on("click",killDerivationSearch),$("#searchClear").on("click",()=>clear("search")),$("#lookupBtn").on("click",handleMyCoolAddressLookup),$("#lookupKill").on("click",killMyCoolAddressLookup),$("#lookupClear").on("click",()=>clear("lookup")),$("#mnemoTxt").on("keyup keydown",mnemonicKeyboardEventHandler),$("#mnemoTxt").on("focusout",mnemonicFocusoutHangler),$("#searchAddress").on("keyup",function(e){checkBase32Input("#searchAddress","#searchInvalid",58)}),$("#lookupWhat").on("keyup",function(e){checkBase32Input("#lookupWhat","#lookupInvalid",6)}),$("#btnPDF").on("click",()=>createPdf());